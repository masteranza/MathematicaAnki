(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[    103964,       2386]
NotebookOptionsPosition[    103376,       2366]
NotebookOutlinePosition[    103978,       2387]
CellTagsIndexPosition[    103935,       2384]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"BeginPackage", "[", 
   RowBox[{"\"\<AnkiExporter`\>\"", ",", 
    RowBox[{"{", "\"\<PackageUtils`\>\"", "}"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExportToAnki", "::", "usage"}], " ", "=", 
   "\"\<Function exporting selected sections of the notebook to Anki using \
cloze notes\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AnkiRequest", "::", "usage"}], "=", 
   "\"\<Pass Action and param (Anki Connect)\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PrepareAnkiNote", "::", "usage"}], "=", 
   "\"\<Deck name then for params and tags (opt)\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AddOrUpdateNotes", "::", "usage"}], "=", 
   "\"\<Deck name then all notes\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TeXFix", "::", "usage"}], "=", 
   "\"\<Joins Anki clozes in TeX string\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExportToCloud", "::", "usage"}], "=", 
   "\"\<Exports Notebook to Cloud under the right path\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AnkiRequest", "[", 
    RowBox[{"action_", ",", 
     RowBox[{"params_:", 
      RowBox[{"<|", "|>"}]}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"req", ",", "json"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"PrintToConsole", "[", "params", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"json", "=", 
       RowBox[{"ImportString", "[", 
        RowBox[{
         RowBox[{"ExportString", "[", 
          RowBox[{
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<action\>\"", "\[Rule]", "action"}], ",", 
             RowBox[{"\"\<version\>\"", "\[Rule]", "6"}], ",", 
             RowBox[{"\"\<params\>\"", "\[Rule]", "params"}]}], "|>"}], ",", 
           "\"\<JSON\>\"", ",", 
           RowBox[{"\"\<Compact\>\"", "\[Rule]", "False"}]}], "]"}], ",", 
         "\"\<Text\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PrintToConsole", "[", "json", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"req", "=", 
       RowBox[{"HTTPRequest", "[", 
        RowBox[{"\[LeftAssociation]", 
         RowBox[{
          RowBox[{"\"\<Scheme\>\"", "\[Rule]", "\"\<http\>\""}], ",", 
          RowBox[{"\"\<Domain\>\"", "\[Rule]", "\"\<localhost\>\""}], ",", 
          RowBox[{"\"\<Port\>\"", "\[Rule]", "8765"}], ",", 
          RowBox[{"Method", " ", "\[Rule]", " ", "\"\<POST\>\""}], ",", 
          RowBox[{"\"\<Body\>\"", "\[Rule]", "json"}]}], 
         "\[RightAssociation]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"URLRead", "[", 
       RowBox[{"req", ",", "\"\<Body\>\""}], "]"}]}]}], "\[IndentingNewLine]",
     "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PrepareAnkiNote", "[", 
    RowBox[{
    "deckName_", ",", "cellID_", ",", "clozed_", ",", "title_", ",", "link_", 
     ",", 
     RowBox[{"tags_:", 
      RowBox[{"{", "}"}]}]}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<deckName\>\"", "\[Rule]", "deckName"}], ",", 
     RowBox[{"\"\<modelName\>\"", "\[Rule]", "\"\<MathematicaCloze\>\""}], 
     ",", 
     RowBox[{"\"\<fields\>\"", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<CellID\>\"", "\[Rule]", 
         RowBox[{"ToString", "[", "cellID", "]"}]}], ",", 
        RowBox[{"\"\<Text\>\"", "\[Rule]", "clozed"}], ",", 
        RowBox[{"\"\<Extra\>\"", "\[Rule]", "title"}], ",", 
        RowBox[{"\"\<Link\>\"", "\[Rule]", "link"}]}], "}"}]}], ",", 
     RowBox[{"\"\<options\>\"", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<allowDuplicate\>\"", "\[Rule]", "False"}], "}"}]}], ",", 
     RowBox[{"\"\<tags\>\"", "\[Rule]", "tags"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AddOrUpdateNotes", "[", 
    RowBox[{"deck_", ",", "rawNotes_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "res", ",", "resi", ",", "toUpdate", ",", "ids", ",", "ankiIds"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"res", "=", 
       RowBox[{"(", 
        RowBox[{"ImportString", "[", 
         RowBox[{
          RowBox[{"AnkiRequest", "[", 
           RowBox[{"\"\<addNotes\>\"", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<notes\>\"", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"PrepareAnkiNote", "[", 
                  RowBox[{"deck", ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                "rawNotes"}], ")"}]}], "}"}]}], "]"}], ",", "\"\<JSON\>\""}], 
         "]"}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"PrintToConsole", "[", 
         RowBox[{"ImportString", "[", 
          RowBox[{
           RowBox[{"AnkiRequest", "[", 
            RowBox[{"\"\<multi\>\"", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<actions\>\"", "\[Rule]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"\"\<action\>\"", "->", "\"\<addNote\>\""}], ",", 
                    
                    RowBox[{"\"\<params\>\"", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"\"\<note\>\"", "\[Rule]", 
                    RowBox[{"PrepareAnkiNote", "[", 
                    RowBox[{"deck", ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}]}], "]"}]}], "}"}]}]}], 
                   "}"}], "&"}], "/@", "rawNotes"}], ")"}]}], "}"}]}], "]"}], 
           ",", "\"\<JSON\>\""}], "]"}], "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"PrintToConsole", "[", "res", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"res", "=", 
       RowBox[{"(", 
        RowBox[{"\"\<result\>\"", "/.", "res"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"toUpdate", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"res", ",", "rawNotes"}], "}"}], "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "Null"}], "&"}]}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PrintToConsole", "[", 
       RowBox[{"\"\<Need to update \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Length", "[", "toUpdate", "]"}], "]"}], "<>", " ", 
        "\"\< notes\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "toUpdate", "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", "=", 
          RowBox[{"{", 
           RowBox[{"\"\<actions\>\"", "\[Rule]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<action\>\"", "->", "\"\<findNotes\>\""}], ",", 
                 RowBox[{"\"\<params\>\"", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"\"\<query\>\"", "\[Rule]", 
                    RowBox[{"\"\<CellID:\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "}"}]}]}], 
                "}"}], "&"}], "/@", "toUpdate"}], ")"}]}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"ankiIds", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", 
           RowBox[{"(", 
            RowBox[{"\"\<result\>\"", "/.", 
             RowBox[{"ImportString", "[", 
              RowBox[{
               RowBox[{"AnkiRequest", "[", 
                RowBox[{"\"\<multi\>\"", ",", "res"}], "]"}], ",", 
               "\"\<JSON\>\""}], "]"}]}], ")"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"toUpdate", "=", 
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"ankiIds", ",", "toUpdate"}], "}"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PrintToConsole", "[", "ankiIds", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PrintToConsole", "[", "toUpdate", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"res", "=", 
          RowBox[{"{", 
           RowBox[{"\"\<actions\>\"", "\[Rule]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<action\>\"", "->", "\"\<updateNoteFields\>\""}],
                  ",", 
                 RowBox[{"\"\<params\>\"", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"\"\<note\>\"", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\"\<id\>\"", "\[Rule]", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<deckName\>\"", "\[Rule]", "deck"}], ",", 
                    RowBox[{
                    "\"\<modelName\>\"", "\[Rule]", 
                    "\"\<MathematicaCloze\>\""}], ",", 
                    RowBox[{"\"\<fields\>\"", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\"\<CellID\>\"", "\[Rule]", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<Text\>\"", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<Extra\>\"", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<Link\>\"", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "4"}], "]"}], "]"}]}]}], "}"}]}], ",", 
                    RowBox[{"\"\<options\>\"", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"\"\<allowDuplicate\>\"", "\[Rule]", "False"}], 
                    "}"}]}]}], "}"}]}], "}"}]}]}], "}"}], "&"}], "/@", 
              "toUpdate"}], ")"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ImportString", "[", 
          RowBox[{
           RowBox[{"AnkiRequest", "[", 
            RowBox[{"\"\<multi\>\"", ",", "res"}], "]"}], ",", 
           "\"\<JSON\>\""}], "]"}]}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"PrintToConsole", "[", 
         RowBox[{"ImportString", "[", 
          RowBox[{
           RowBox[{"AnkiRequest", "[", 
            RowBox[{"\"\<updateNoteFields\>\"", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<note\>\"", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<id\>\"", "\[Rule]", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                 RowBox[{"\"\<fields\>\"", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"\"\<CellID\>\"", "\[Rule]", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<Text\>\"", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<Extra\>\"", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<Link\>\"", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "4"}], "]"}], "]"}]}]}], "}"}]}]}], 
                "}"}]}], "}"}]}], "]"}], ",", "\"\<JSON\>\""}], "]"}], "]"}], 
        "&"}], "/@", "toUpdate"}], ";"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"PrintToConsole", "[", 
       RowBox[{"ImportString", "[", 
        RowBox[{
         RowBox[{"AnkiRequest", "[", 
          RowBox[{"\"\<notesInfo\>\"", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<notes\>\"", "\[Rule]", 
             RowBox[{"toUpdate", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         ",", "\"\<JSON\>\""}], "]"}], "]"}], ";"}], "*)"}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TeXFix", "[", "what_", "]"}], ":=", 
   RowBox[{"StringReplace", "[", 
    RowBox[{
     RowBox[{"StringReplace", "[", 
      RowBox[{"what", ",", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"\"\<}}\>\"", "~~", 
           RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<{{c\>\"", "~~", 
           
           RowBox[{"Shortest", "[", "___", "]"}], "~~", "\"\<::\>\""}], "->", 
          "\"\<\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"\"\<\\\\({{c\>\"", "~~", 
           RowBox[{"Shortest", "[", "c__", "]"}], "~~", "\"\<::\>\"", "~~", 
           RowBox[{"Shortest", "[", "d__", "]"}], "~~", "\"\<}}\\\\)\>\""}], ":>", 
          RowBox[{"(", 
           RowBox[{
           "\"\<{{c\>\"", "<>", "c", "<>", "\"\<::\\\\(\>\"", "<>", "d", 
            "<>", "\"\<\\\\)}}\>\""}], ")"}]}]}], "}"}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"\"\<}}\>\"", "~~", 
         RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<{{c\>\"", "~~", 
         RowBox[{"Shortest", "[", "___", "]"}], "~~", "\"\<::\>\""}], 
        "\[Rule]", "\"\<\>\""}], ",", 
       RowBox[{"\"\<\\\\)\\\\(\>\"", "->", "\"\<\>\""}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FixRefs", "[", "what_", "]"}], ":=", 
   RowBox[{"Replace", "[", 
    RowBox[{
     RowBox[{"Replace", "[", 
      RowBox[{"what", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ButtonBox", "[", 
          RowBox[{"___", ",", 
           RowBox[{"Tooltip", "\[Rule]", 
            RowBox[{"DynamicBox", "[", 
             RowBox[{"c__", ",", 
              RowBox[{"UpdateInterval", "\[Rule]", "\[Infinity]"}]}], "]"}]}],
            ",", "___"}], "]"}], "\[RuleDelayed]", 
         RowBox[{"Temp", "[", "c", "]"}]}], "\[IndentingNewLine]", "}"}], ",",
        "Infinity"}], "]"}], ",", 
     RowBox[{
      RowBox[{"Temp", "[", 
       RowBox[{"RowBox", "[", 
        RowBox[{"{", 
         RowBox[{"_", ",", "d___"}], "}"}], "]"}], "]"}], "\[RuleDelayed]", 
      "d"}], ",", "Infinity"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"openCloseAll", "[", 
    RowBox[{"nb_", ",", "target_String", ",", 
     RowBox[{"to", ":", 
      RowBox[{"(", 
       RowBox[{"Open", "|", "Closed"}], ")"}]}]}], "]"}], ":=", 
   RowBox[{"Do", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"SelectionMove", "[", 
       RowBox[{"cell", ",", "All", ",", "CellGroup", ",", 
        RowBox[{"AutoScroll", "\[Rule]", "False"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"content", "=", 
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"$Context", "=", "\"\<FrontEnd`\>\""}], ",", 
               RowBox[{"$ContextPath", "=", 
                RowBox[{"{", "\"\<System`\>\"", "}"}]}]}], "}"}], ",", 
             RowBox[{"NotebookRead", "[", "nb", "]"}]}], "]"}]}], ",", 
          RowBox[{"from", "=", 
           RowBox[{"to", "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Closed", "\[Rule]", "Open"}], ",", 
              RowBox[{"Open", "\[Rule]", "Closed"}]}], "}"}]}]}]}], "}"}], 
        ",", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MatchQ", "[", 
           RowBox[{"content", ",", 
            RowBox[{"Cell", "[", 
             RowBox[{"CellGroupData", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Cell", "[", 
                  RowBox[{"_", ",", "target", ",", "___"}], "]"}], ",", 
                 "__"}], "}"}], ",", "from"}], "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"NotebookWrite", "[", 
           RowBox[{"nb", ",", 
            RowBox[{"Cell", "[", 
             RowBox[{"CellGroupData", "[", 
              RowBox[{
               RowBox[{"content", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", "to"}], "]"}], 
             "]"}], ",", 
            RowBox[{"AutoScroll", "\[Rule]", "False"}]}], "]"}]}], "]"}]}], 
       "]"}], ";"}], ",", 
     RowBox[{"{", 
      RowBox[{"cell", ",", 
       RowBox[{"Cells", "[", 
        RowBox[{"CellStyle", "\[Rule]", "target"}], "]"}]}], "}"}]}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cell", "[", 
    RowBox[{"content_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"Cell", "[", 
    RowBox[{
     RowBox[{"BoxData", "[", 
      RowBox[{"ToBoxes", "[", "content", "]"}], "]"}], ",", "opts", ",", 
     RowBox[{"ShowStringCharacters", "->", "False"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExportToCloud", "[", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"s", ",", "fn", ",", "cn", ",", "su"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"fn", "=", 
       RowBox[{"StringReplace", "[", 
        RowBox[{
         RowBox[{"NotebookFileName", "[", 
          RowBox[{"EvaluationNotebook", "[", "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{
          "e___", "~~", "\"\</Knowledge/\>\"", " ", "~~", " ", "f___"}], " ", 
          "\[RuleDelayed]", " ", 
          RowBox[{"\"\</Knowledge/\>\"", "<>", "f"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cn", "=", 
       RowBox[{"\"\<user:\>\"", "<>", 
        RowBox[{
         RowBox[{"StringSplit", "[", 
          RowBox[{
           RowBox[{"CloudConnect", "[", "]"}], ",", "\"\<@\>\""}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "<>", "fn"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s", "=", 
       RowBox[{"CloudDeploy", "[", 
        RowBox[{
         RowBox[{"EvaluationNotebook", "[", "]"}], ",", "cn"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"su", "=", 
       RowBox[{"Quiet", "@", 
        RowBox[{"CloudDeploy", "[", 
         RowBox[{
          RowBox[{"URLDispatcher", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"\"\</\>\"", "~~", "EndOfString"}], "\[RuleDelayed]", 
              RowBox[{"Delayed", "@", 
               RowBox[{"CloudImport", "@", "s"}]}]}], ",", 
             RowBox[{
              RowBox[{"\"\</\>\"", "~~", " ", 
               RowBox[{"base", ":", 
                RowBox[{"Repeated", "[", 
                 RowBox[{"DigitCharacter", ",", "20"}], "]"}]}]}], 
              "\[RuleDelayed]", 
              RowBox[{"Delayed", "@", 
               RowBox[{"ExportForm", "[", 
                RowBox[{
                 RowBox[{"Notebook", "[", 
                  RowBox[{
                   RowBox[{"Append", "[", 
                    RowBox[{
                    RowBox[{"First", "@", 
                    RowBox[{"CloudGet", "@", "s"}]}], ",", 
                    RowBox[{"cell", "@", 
                    RowBox[{"EmbeddedHTML", "[", 
                    RowBox[{
                    "\"\<<script>\nfunction openCloseGroup() {\n\
wolfram.cloud.parentNotebook.evaluateExpression({\n    expression: \
'FrontEndExecute[NotebookLocate[\\\"\>\"", "<>", "base", "<>", 
                    "\"\<\\\"]]' });\n}\n</script>\n<body \
onload='openCloseGroup()'>\>\""}], "]"}]}]}], "]"}], ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Rest", "@", "s"}], ")"}], "/.", 
                    RowBox[{"{", 
                    RowBox[{"Notebook", "\[Rule]", "Sequence"}], "}"}]}]}], 
                  "]"}], ",", "\"\<CloudCDF\>\""}], "]"}]}]}]}], "}"}], "]"}],
           ",", 
          RowBox[{"StringDrop", "[", 
           RowBox[{"cn", ",", 
            RowBox[{"-", "3"}]}], "]"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"StringDrop", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"StringSplit", "[", 
           RowBox[{
            RowBox[{"CloudConnect", "[", "]"}], ",", "\"\<@\>\""}], "]"}], 
          "[", 
          RowBox[{"[", "1", "]"}], "]"}], "<>", "fn"}], ",", 
        RowBox[{"-", "3"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExportToAnki", "[", 
    RowBox[{"sync_:", "True"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "separator", ",", "styleTags", ",", "cells", ",", "sections", ",", 
       "subsections", ",", "subsubsections", ",", "subsubsubsections", ",", 
       "allinfo", ",", "cellids", ",", "celltags", ",", "data", ",", "ids", 
       ",", "cloze", ",", "matchEq", ",", "encoding", ",", "eqCloze", ",", 
       "GetTOC", ",", "exported", ",", "filtered", ",", "splited", ",", 
       "marked", ",", "paths", ",", "fixed", ",", "final", ",", "threaded", 
       ",", "deck", ",", "title", ",", " ", "base", ",", "dat", ",", "ndir", 
       ",", "tempPicPath", ",", " ", "allspecial", ",", "npath", ",", 
       "backupc", ",", "cloudex"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cloudex", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"!", "$CloudConnected"}], "&&", 
          RowBox[{"$WolframID", "===", "None"}]}], ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"CloudConnect", "[", "]"}], "===", "$Failed"}], "||", 
            RowBox[{
             RowBox[{"CloudConnect", "[", "]"}], "===", "$Canceled"}]}], ",", 
           "False", ",", "True"}], "]"}], ",", "True"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"separator", "=", "\"\<#\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{"ShowStatus", "[", "\"\<Export starts\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintToConsole", "[", "\"\<Export starts\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"TeXForm", "[", "1", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{
         "System`Convert`TeXFormDump`maketex", "[", "\"\<\[LeftSkeleton]\>\"",
           "]"}], "=", "\"\<\\\\ll \>\""}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
         "System`Convert`TeXFormDump`maketex", "[", 
          "\"\<\[RightSkeleton]\>\"", "]"}], "=", "\"\<\\\\gg \>\""}], ";"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "System`Convert`TeXFormDump`maketex", "[", "\"\<\[OAcute]\>\"", "]"}], 
       "=", "\"\<\[OAcute]\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "System`Convert`TeXFormDump`maketex", "[", 
        "\"\<\[CloseCurlyQuote]\>\"", "]"}], "=", "\"\<'\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "System`Convert`TeXFormDump`maketex", "[", "\"\<\:015b\>\"", "]"}], 
       "=", "\"\<\:015b\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "System`Convert`TeXFormDump`maketex", "[", "\"\<\[CAcute]\>\"", "]"}], 
       "=", "\"\<\[CAcute]\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "System`Convert`TeXFormDump`maketex", "[", "\"\<\:0119\>\"", "]"}], 
       "=", "\"\<\:0119\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "System`Convert`TeXFormDump`maketex", "[", "\"\<\:0105\>\"", "]"}], 
       "=", "\"\<\:0105\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "System`Convert`TeXFormDump`maketex", "[", "\"\<\[LSlash]\>\"", "]"}], 
       "=", "\"\<\[LSlash]\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "System`Convert`TeXFormDump`maketex", "[", "\"\<\:017c\>\"", "]"}], 
       "=", "\"\<\:017c\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "System`Convert`TeXFormDump`maketex", "[", "\"\<\:017a\>\"", "]"}], 
       "=", "\"\<\:017a\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{
         "System`Convert`TeXFormDump`maketex", "[", "\"\<&\>\"", "]"}], "=", 
         "\"\<\\\\$ \>\""}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"System`Convert`TeXFormDump`maketex", "[", "\"\<~\>\"", "]"}], 
       "=", "\"\<\\\\sim \>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "System`Convert`TeXFormDump`maketex", "[", "\"\<\[Perpendicular]\>\"", 
        "]"}], "=", "\"\<\\\\perp \>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "nie", " ", "zamieniaj", " ", "zwyk\[LSlash]ego", " ", "tekstu"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"System`Convert`CommonDump`ConvertTextData", "[", 
        RowBox[{
        "contents_String", ",", "toFormat_", ",", "toFormatStream_", ",", 
         "conversionRules_", ",", 
         RowBox[{"opts___", "?", "OptionQ"}]}], "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "fpre", ",", "frule", ",", "fpost", ",", "pstyle", ",", "popts", 
           ",", 
           RowBox[{"str", "=", "contents"}]}], "}"}], ",", 
         RowBox[{
          RowBox[{"System`Convert`CommonDump`DebugPrint", "[", 
           RowBox[{
           "\"\<CONVERTCOMMON:ConvertTextData-general content: \>\"", ",", 
            "contents"}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"pstyle", "=", 
           RowBox[{
            RowBox[{"System`Convert`CommonDump`ParentCellStyle", "/.", 
             RowBox[{"{", "opts", "}"}]}], "/.", 
            RowBox[{
            "System`Convert`CommonDump`ParentCellStyle", "\[Rule]", 
             "\"\<\>\""}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"popts", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"System`Convert`CommonDump`ParentOptions", "/.", 
              RowBox[{"List", "/@", 
               RowBox[{"{", "opts", "}"}]}]}], "/.", 
             RowBox[{"System`Convert`CommonDump`ParentOptions", "\[Rule]", 
              RowBox[{"{", "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"System`Convert`CommonDump`DebugPrint", "[", 
           RowBox[{"\"\<pstyle: \>\"", ",", "pstyle"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"fpre", ",", "frule", ",", "fpost"}], "}"}], "=", 
           RowBox[{"System`Convert`CommonDump`ConvertFormatRule", "[", 
            RowBox[{
             RowBox[{"pstyle", "/.", "conversionRules"}], ",", "False"}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"System`Convert`CommonDump`DebugPrint", "[", 
           RowBox[{"\"\<{fpre, frule, fpost}: \>\"", ",", 
            RowBox[{"\"\<InputForm\>\"", "[", 
             RowBox[{"{", 
              RowBox[{"fpre", ",", "frule", ",", "fpost"}], "}"}], "]"}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"frule", "===", "Automatic"}], ",", 
            RowBox[{"frule", "=", 
             RowBox[{
              RowBox[{"System`Convert`CommonDump`ConvertText", "[", 
               RowBox[{"#1", ",", "toFormat", ",", "opts"}], "]"}], "&"}]}]}],
            "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
               "System`Convert`CommonDump`ShowQuotesQ", "[", "pstyle", "]"}], 
               "||", 
               RowBox[{"TrueQ", "[", 
                RowBox[{"System`Convert`CommonDump`ShowQuotes", "/.", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", "opts", "}"}], "]"}]}], "]"}], "||", 
               RowBox[{"TrueQ", "[", 
                RowBox[{"ShowStringCharacters", "/.", "popts"}], "]"}]}], 
              ")"}]}], ",", 
            RowBox[{"str", "=", 
             RowBox[{
             "System`Convert`CommonDump`RemoveQuotes", "[", "str", "]"}]}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"System`Convert`CommonDump`DebugPrint", "[", 
           RowBox[{"\"\<str: \>\"", ",", "frule"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"TrueQ", "[", 
                RowBox[{"System`Convert`CommonDump`ConvertText", "/.", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", "opts", "}"}], "]"}]}], "]"}]}], ",", 
              RowBox[{"str", "=", 
               RowBox[{"frule", "[", "str", "]"}]}]}], "]"}], ";"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"System`Convert`CommonDump`DebugPrint", "[", 
           RowBox[{"\"\<str: \>\"", ",", "str"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
          "System`Convert`CommonDump`DebugPrint", "[", 
           "\"\<CONVERTCOMMON-ConvertTextData.  Writing the string. \
HIJACK\>\"", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{
          "System`Convert`CommonDump`DebugPrint", "[", 
           "\"\<------------------------------------------\>\"", "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"WriteString", "[", 
           RowBox[{"toFormatStream", ",", "str"}], "]"}], ";"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"przekieruj", " ", "zwyk\[LSlash]y", " ", "tekst"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"System`Convert`CommonDump`ConvertTextData", "[", 
        RowBox[{
        "contents_", ",", "toFormat_", ",", "toFormatStream_", ",", 
         "conversionRules_", ",", "others___"}], "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", "cell", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MatchQ", "[", 
            RowBox[{"contents", ",", 
             RowBox[{"Anki", "[", 
              RowBox[{"_", ",", "_String"}], "]"}]}], "]"}], ",", 
           RowBox[{
            RowBox[{"WriteString", "[", 
             RowBox[{"toFormatStream", ",", 
              RowBox[{"contents", "/.", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Anki", "[", 
                  RowBox[{"nr_", ",", "s_String"}], "]"}], "\[RuleDelayed]", 
                 RowBox[{"(", 
                  RowBox[{"\"\<{{c\>\"", "<>", 
                   RowBox[{"ToString", "[", "nr", "]"}], "<>", "\"\<::\>\"", "<>", 
                   RowBox[{"StringReplace", "[", 
                    RowBox[{"s", ",", 
                    RowBox[{"\"\<}}\>\"", "\[Rule]", "\"\<} }\>\""}]}], "]"}],
                    "<>", "\"\< }} \>\""}], ")"}]}], "}"}]}]}], "]"}], ";"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"System`Convert`CommonDump`DebugPrint", "[", 
             RowBox[{
             "\"\<CONVERTCOMMON-ConvertTextData of unknown content: \>\"", 
              ",", "contents"}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"cell", "=", 
             RowBox[{"Cell", "[", 
              RowBox[{
               RowBox[{"BoxData", "[", "contents", "]"}], ",", "\"\<\>\""}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"System`Convert`CommonDump`PreConvertCell", "[", 
             RowBox[{
             "cell", ",", "toFormat", ",", "toFormatStream", ",", 
              "conversionRules", ",", 
              RowBox[{"(*", "System`Convert`CommonDump`", "*)"}], 
              RowBox[{"inlineCell", "\[Rule]", "True"}], ",", "others"}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"System`Convert`CommonDump`ConvertCell", "[", 
             RowBox[{
             "cell", ",", "toFormat", ",", "toFormatStream", ",", 
              "conversionRules", ",", 
              RowBox[{"(*", "System`Convert`CommonDump`", "*)"}], 
              RowBox[{"inlineCell", "\[Rule]", "True"}], ",", "others"}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"System`Convert`CommonDump`PostConvertCell", "[", 
             RowBox[{
             "cell", ",", "toFormat", ",", "toFormatStream", ",", 
              "conversionRules", ",", 
              RowBox[{"(*", "System`Convert`CommonDump`", "*)"}], 
              RowBox[{"inlineCell", "\[Rule]", "True"}], ",", "others"}], 
             "]"}], ";"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "blokowanie", " ", "zamiany", " ", "na", " ", "unicode", " ", 
         "wrappers"}], " ", "-", " ", 
        RowBox[{"raczej", " ", "nie", " ", "potrzebne"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"System`Convert`TeXFormDump`maketex", "[", 
          RowBox[{"str_String", " ", "/;", " ", 
           RowBox[{
            RowBox[{"StringLength", "[", "str", "]"}], " ", "===", " ", 
            "1"}]}], "]"}], " ", ":=", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
           "System`Convert`CommonDump`DebugPrint", "[", 
            "\"\<------------------------------------\>\"", "]"}], ";", "\n", 
           "    \t", 
           RowBox[{
           "System`Convert`CommonDump`DebugPrint", "[", 
            "\"\<maketex[str_String/;(StringLength@str===1)]\>\"", "]"}], ";",
            "\n", "    \t", 
           RowBox[{"System`Convert`CommonDump`DebugPrint", "[", 
            RowBox[{"\"\<str: \>\"", ",", " ", "str"}], "]"}], ";", "\n", 
           "  ", "str"}], "  \t", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"$Language", " ", "===", " ", "\"\<Japanese\>\""}], " ",
               "||", " ", "\n", "        ", 
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"\"\<ShiftJIS\>\"", ",", " ", "\"\<EUC\>\""}], "}"}],
                 ",", " ", "$CharacterEncoding"}], "]"}]}], ",", " ", "str", 
             ",", " ", "\n", "      ", 
             RowBox[{"\"\<\\\\unicode{\>\"", " ", "<>", " ", 
              RowBox[{
              "System`Convert`TeXFormDump`ToCharacterHexCode", "[", "str", 
               "]"}], " ", "<>", " ", "\"\<}\>\""}]}], "]"}], "*)"}], ")"}]}],
         ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Anki", " ", "markup"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"System`Convert`TeXFormDump`maketex", "[", 
        RowBox[{"Anki", "[", 
         RowBox[{"nr_", ",", "boxes_"}], "]"}], "]"}], ":=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
         "System`Convert`CommonDump`DebugPrint", "[", 
          "\"\<------------------------------------\>\"", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
         "System`Convert`CommonDump`DebugPrint", "[", 
          "\"\<maketex[Anki[nr_, boxes__]]\>\"", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"System`Convert`CommonDump`DebugPrint", "[", 
          RowBox[{"\"\<boxes: \>\"", ",", "boxes"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"StringQ", "[", "boxes", "]"}], ",", 
           RowBox[{"\"\<{{c\>\"", "<>", 
            RowBox[{"ToString", "[", "nr", "]"}], "<>", "\"\<::\>\"", "<>", 
            RowBox[{"StringReplace", "[", 
             RowBox[{"boxes", ",", 
              RowBox[{"\"\<}}\>\"", "\[Rule]", "\"\<} }\>\""}]}], "]"}], 
            "<>", "\"\< }} \>\""}], ",", "\[IndentingNewLine]", 
           RowBox[{"\"\<{{c\>\"", "<>", 
            RowBox[{"ToString", "[", "nr", "]"}], "<>", "\"\<::\>\"", "<>", 
            RowBox[{"StringReplace", "[", 
             RowBox[{
              RowBox[{
              "System`Convert`TeXFormDump`MakeTeX", "[", "boxes", "]"}], ",", 
              
              RowBox[{"\"\<}}\>\"", "\[Rule]", "\"\<} }\>\""}]}], "]"}], 
            "<>", "\"\< }} \>\""}]}], "]"}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"ShowStatus", "[", "\"\<Export to Anki begins...\>\"", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"NotebookDirectory", "[", "]"}], "===", "$Failed"}], ",", 
        RowBox[{
         RowBox[{"ShowStatus", "[", "\"\<Nothing to export\>\"", "]"}], ";", 
         " ", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"tempPicPath", "=", 
       RowBox[{"Quiet", "@", 
        RowBox[{"Check", "[", 
         RowBox[{
          RowBox[{"CreateDirectory", "[", 
           RowBox[{"\"\<~/Dropbox/Anki/Ranza/collection.media/\>\"", ",", 
            RowBox[{
            "CreateIntermediateDirectories", "\[Rule]", " ", "True"}]}], 
           "]"}], ",", "\"\<~/Dropbox/Anki/Ranza/collection.media/\>\"", ",", 
          
          StyleBox[
           RowBox[{"CreateDirectory", "::", "filex"}], "MessageName"]}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"FixStrings", "[", "data_", "]"}], ":=", 
       RowBox[{"StringReplace", "[", 
        RowBox[{"data", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<\[Lambda]\>\"", ":>", "\"\<\\(\\\\lambda\\)\>\""}], 
           ",", 
           RowBox[{"\"\<\[Dash]\>\"", ":>", "\"\<-\>\""}], ",", 
           RowBox[{
           "\"\<\[Rule]\>\"", ":>", "\"\<\\(\\\\rightarrow\\)\>\""}]}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"TeXFix", "[", "what_", "]"}], ":=", 
         RowBox[{"StringReplace", "[", 
          RowBox[{"what", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<\\)}}\\(\\)\>\"", "\[Rule]", " ", "\"\<\\)}}\>\""}],
              ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\"\<\\\\text{\>\"", "~~", 
                RowBox[{"c", ":", 
                 RowBox[{
                  RowBox[{"Except", "[", "\"\<}\>\"", "]"}], ".."}]}], "~~", 
                "\"\<}\>\""}], ")"}], ":>", 
              RowBox[{"(", 
               RowBox[{"ToString", "@", "c"}], ")"}]}]}], "}"}]}], "]"}]}], 
        ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"TeXFixPoor", "[", "what_", "]"}], ":=", 
       RowBox[{"StringReplace", "[", 
        RowBox[{"what", ",", 
         RowBox[{"{", 
          RowBox[{"\"\<\\)}}\\(\\)\>\"", "\[Rule]", " ", "\"\<\\)}}\>\""}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"EncodingFix", "[", "what_", "]"}], ":=", 
       RowBox[{"FromCharacterCode", "[", 
        RowBox[{
         RowBox[{"ToCharacterCode", "[", "what", "]"}], ",", "\"\<UTF8\>\""}],
         "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ToTex", "[", 
        RowBox[{"what_", ",", 
         RowBox[{"n_:", "1"}]}], "]"}], ":=", 
       RowBox[{"Convert`TeX`BoxesToTeX", "[", 
        RowBox[{"what", ",", " ", 
         RowBox[{"\"\<BoxRules\>\"", "\[Rule]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
            "\"\<\[Transpose]\>\"", "\[RuleDelayed]", 
             "\"\<^{\\\\mathsf{T}}\>\""}], ",", "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\[ConjugateTranspose]\>\"", "\[RuleDelayed]", 
             "\"\<^{\\\\dagger} \>\""}], ",", "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\[HermitianConjugate]\>\"", "\[RuleDelayed]", 
             "\"\<^{\\\\dagger} \>\""}], ",", "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\[Conjugate]\>\"", "\[RuleDelayed]", "\"\<^{*} \>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\[OAcute]\>\"", "\[RuleDelayed]", " ", "\"\<\[OAcute]\>\""}],
             ",", "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\[CapitalOAcute]\>\"", "\[RuleDelayed]", " ", 
             "\"\<\[CapitalOAcute]\>\""}], ",", "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\:015b\>\"", "\[RuleDelayed]", " ", "\"\<\:015b\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\:015a\>\"", "\[RuleDelayed]", " ", "\"\<\:015a\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\[CAcute]\>\"", "\[RuleDelayed]", " ", "\"\<\[CAcute]\>\""}],
             ",", "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\[CapitalCAcute]\>\"", "\[RuleDelayed]", " ", 
             "\"\<\[CapitalCAcute]\>\""}], ",", "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\:0119\>\"", "\[RuleDelayed]", " ", "\"\<\:0119\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\:0118\>\"", "\[RuleDelayed]", " ", "\"\<\:0118\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\:0105\>\"", "\[RuleDelayed]", " ", "\"\<\:0105\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\:0104\>\"", "\[RuleDelayed]", " ", "\"\<\:0104\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\[LSlash]\>\"", "\[RuleDelayed]", " ", "\"\<\[LSlash]\>\""}],
             ",", "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\[CapitalLSlash]\>\"", "\[RuleDelayed]", " ", 
             "\"\<\[CapitalLSlash]\>\""}], ",", "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\:017c\>\"", "\[RuleDelayed]", " ", "\"\<\:017c\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
            "\"\<\:017b\>\"", "\[RuleDelayed]", " ", "\"\<\:017b\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"\"\<\:017a\>\"", "\[RuleDelayed]", "\"\<\:017a\>\""}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"\"\<\:0179\>\"", "\[RuleDelayed]", "\"\<\:0179\>\""}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"\"\<\:0144\>\"", "\[RuleDelayed]", "\"\<\:0144\>\""}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"\"\<\:0143\>\"", "\[RuleDelayed]", "\"\<\:0143\>\""}], 
            ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"FormBox", "[", 
               RowBox[{
                RowBox[{"GraphicsBox", "[", 
                 RowBox[{
                  RowBox[{"{", "C__", "}"}], ",", "E___", ",", 
                  RowBox[{"ImageSize", "\[Rule]", "D_"}]}], "]"}], ",", 
                "__"}], "]"}], "|", 
              RowBox[{"GraphicsBox", "[", 
               RowBox[{
                RowBox[{"{", "C__", "}"}], ",", "E___", ",", 
                RowBox[{"ImageSize", "\[Rule]", "D_"}]}], "]"}]}], 
             "\[RuleDelayed]", 
             RowBox[{"(", 
              RowBox[{"\"\<\\\\includegraphics[natwidth=\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"First", "@", "D"}], ")"}], "/", "4"}], "]"}], 
               "<>", "\"\<,natheight=\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"First", "@", "D"}], ")"}], "/", "4"}], "]"}], 
               "<>", "\"\<]{\>\"", "<>", 
               RowBox[{"FileNameTake", "@", 
                RowBox[{"Export", "[", 
                 RowBox[{
                  RowBox[{"tempPicPath", "<>", "\"\<f\>\"", "<>", 
                   RowBox[{"ToString", "[", 
                    RowBox[{"Hash", "[", 
                    RowBox[{"Graphics", "[", 
                    RowBox[{
                    RowBox[{"{", "C", "}"}], ",", "E"}], "]"}], "]"}], "]"}], 
                   "<>", "\"\<.png\>\""}], ",", 
                  RowBox[{"Graphics", "[", 
                   RowBox[{
                    RowBox[{"{", "C", "}"}], ",", "E"}], "]"}], ",", 
                  RowBox[{"ImageSize", "\[Rule]", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"First", "@", "D"}], ",", 
                    RowBox[{"First", "@", "D"}]}], "}"}]}]}], "]"}]}], "<>", 
               "\"\<} \>\""}], ")"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"FormBox", "[", 
              RowBox[{
               RowBox[{"GraphicsBox", "[", "___", "]"}], ",", "___"}], "]"}], 
             "\[RuleDelayed]", " ", "\"\<\>\""}], ",", "\[IndentingNewLine]", 
            
            RowBox[{
             RowBox[{"GraphicsBox", "[", "___", "]"}], "\[RuleDelayed]", " ", 
             "\"\<\>\""}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            
            RowBox[{
             RowBox[{"StyleBox", "[", 
              RowBox[{"D_", ",", 
               RowBox[{"Background", "\[Rule]", "LightGreen"}]}], "]"}], 
             "\[RuleDelayed]", 
             RowBox[{"\"\<\\\\color[HTML]{1111FF}{{c\>\"", "<>", 
              RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<::\>\"", "<>", 
              RowBox[{"StringReplace", "[", 
               RowBox[{
                RowBox[{"ToTex", "[", "D", "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"\"\<{{\>\"", "\[RuleDelayed]", "\"\< { { \>\""}], 
                  ",", 
                  RowBox[{"\"\<}}\>\"", "\[RuleDelayed]", "\"\< } } \>\""}]}],
                  "}"}]}], "]"}], "<>", 
              "\"\< }}\\\\color[HTML]{000000}\>\""}]}]}], "}"}]}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"the", " ", "above", " ", "is", " ", "old"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"cells", "=", 
       RowBox[{"Cells", "[", 
        RowBox[{
         RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
         RowBox[{"CellStyle", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Text\>\"", ",", "\"\<EquationNumbered\>\"", ",", 
            "\"\<Equation\>\"", ",", "\"\<Figure\>\"", ",", "\"\<Item1\>\"", 
            ",", "\"\<Item2\>\"", ",", "\"\<Item3\>\"", ",", 
            "\"\<Item1Numbered\>\"", ",", "\"\<Item2Numbered\>\"", ",", 
            "\"\<Item3Numbered\>\"", ",", "\"\<Example\>\"", ",", 
            "\"\<Exercise\>\"", ",", "\"\<Solution\>\"", ",", 
            "\"\<Question\>\"", ",", "\"\<Remark\>\"", ",", "\"\<Comment\>\"",
             ",", "\"\<Theorem\>\"", ",", "\"\<Proof\>\"", ",", 
            "\"\<Axiom\>\"", ",", "\"\<Definition\>\"", ",", "\"\<Lemma\>\"", 
            ",", "\"\<Corollary\>\""}], "}"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"title", "=", 
       RowBox[{"First", "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"NotebookGet", "@", 
             RowBox[{"EvaluationNotebook", "[", "]"}]}], ",", 
            RowBox[{
             RowBox[{"Cell", "[", 
              RowBox[{"name_", ",", 
               RowBox[{"style", ":", "\"\<Title\>\""}], ",", "___"}], "]"}], 
             "\[RuleDelayed]", "name"}], ",", "Infinity"}], "]"}], "/.", 
          RowBox[{
           RowBox[{"{", "}"}], "\[Rule]", " ", 
           RowBox[{"{", "\"\<\>\"", "}"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ShowStatus", "[", "\"\<Gathering section info...\>\"", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"sections", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"CurrentValue", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<CounterValue\>\"", ",", "\"\<Section\>\""}], "}"}]}],
           "]"}], "&"}], "/@", "cells"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"subsections", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"CurrentValue", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<CounterValue\>\"", ",", "\"\<Subsection\>\""}], 
            "}"}]}], "]"}], "&"}], "/@", "cells"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"subsubsections", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"CurrentValue", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<CounterValue\>\"", ",", "\"\<Subsubsection\>\""}], 
            "}"}]}], "]"}], "&"}], "/@", "cells"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"subsubsubsections", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"CurrentValue", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<CounterValue\>\"", ",", "\"\<Subsubsubsection\>\""}],
             "}"}]}], "]"}], "&"}], "/@", "cells"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"celltags", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Riffle", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"MatchQ", "[", 
              RowBox[{
               RowBox[{"CurrentValue", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"{", "\"\<CellTags\>\"", "}"}]}], "]"}], ",", 
               "_String"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"CurrentValue", "[", 
               RowBox[{"#", ",", 
                RowBox[{"{", "\"\<CellTags\>\"", "}"}]}], "]"}], "}"}], ",", 
             RowBox[{"CurrentValue", "[", 
              RowBox[{"#", ",", 
               RowBox[{"{", "\"\<CellTags\>\"", "}"}]}], "]"}]}], "]"}], ",", 
           "\"\< \>\""}], "]"}], "&"}], "/@", "cells"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"allinfo", "=", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{
         RowBox[{"Replace", "[", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{
             "sections", ",", "subsections", ",", "subsubsections", ",", 
              "subsubsubsections"}], "}"}], "]"}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x___", ",", 
              RowBox[{"0", "..."}]}], "}"}], "\[RuleDelayed]", 
            RowBox[{"{", "x", "}"}]}], ",", "1"}], "]"}], ",", "0", ",", 
         "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ShowStatus", "[", "\"\<Gathering table of contents\>\"", "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"GetTOC", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Cases", "[", 
            RowBox[{
             RowBox[{"NotebookGet", "@", 
              RowBox[{"EvaluationNotebook", "[", "]"}]}], ",", 
             RowBox[{
              RowBox[{"Cell", "[", 
               RowBox[{"name_", ",", 
                RowBox[{"style", ":", 
                 RowBox[{
                 "\"\<Section\>\"", "|", "\"\<Subsection\>\"", "|", 
                  "\"\<Subsubsection\>\"", "|", 
                  "\"\<Subsubsubsection\>\""}]}], ",", "___"}], "]"}], 
              "\[RuleDelayed]", 
              RowBox[{"{", 
               RowBox[{"style", ",", 
                RowBox[{"Convert`TeX`BoxesToTeX", "[", " ", 
                 RowBox[{"name", ",", 
                  RowBox[{"\"\<BoxRules\>\"", "\[Rule]", 
                   RowBox[{"{", 
                    RowBox[{"D_String", "\[RuleDelayed]", "D"}], "}"}]}]}], 
                 "]"}]}], "}"}]}], ",", "Infinity"}], "]"}], "/.", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Subsubsubsection\>\"", ",", "x_"}], "}"}], 
            "\[RuleDelayed]", 
            RowBox[{"x", "[", "]"}]}]}], "//.", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x___", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<Subsubsection\>\"", ",", "y_"}], "}"}], ",", 
             RowBox[{"z", ":", 
              RowBox[{
               RowBox[{"Except", "[", "_List", "]"}], "..."}]}], ",", 
             RowBox[{"w", ":", 
              RowBox[{
               RowBox[{"PatternSequence", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"_", ",", "_"}], "}"}], ",", "___"}], "]"}], "|", 
               RowBox[{"PatternSequence", "[", "]"}]}]}]}], "}"}], 
           "\[RuleDelayed]", 
           RowBox[{"{", 
            RowBox[{"x", ",", 
             RowBox[{"y", "[", "z", "]"}], ",", "w"}], "}"}]}]}], "//.", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"x___", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<Subsection\>\"", ",", "y_"}], "}"}], ",", 
            RowBox[{"z", ":", 
             RowBox[{
              RowBox[{"Except", "[", "_List", "]"}], "..."}]}], ",", 
            RowBox[{"w", ":", 
             RowBox[{
              RowBox[{"PatternSequence", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"_", ",", "_"}], "}"}], ",", "___"}], "]"}], "|", 
              RowBox[{"PatternSequence", "[", "]"}]}]}]}], "}"}], 
          "\[RuleDelayed]", 
          RowBox[{"{", 
           RowBox[{"x", ",", 
            RowBox[{"y", "[", "z", "]"}], ",", "w"}], "}"}]}]}], "//.", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x___", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<Section\>\"", ",", "y_"}], "}"}], ",", 
           RowBox[{"z", ":", 
            RowBox[{
             RowBox[{"Except", "[", "_List", "]"}], "..."}]}], ",", 
           RowBox[{"w", ":", 
            RowBox[{
             RowBox[{"PatternSequence", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"_", ",", "_"}], "}"}], ",", "___"}], "]"}], "|", 
             RowBox[{"PatternSequence", "[", "]"}]}]}]}], "}"}], 
         "\[RuleDelayed]", 
         RowBox[{"{", 
          RowBox[{"x", ",", 
           RowBox[{"y", "[", "z", "]"}], ",", "w"}], "}"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ShowStatus", "[", "\"\<Preparing paths...\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"paths", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"title", "<>", "\"\</\>\"", "<>", 
           RowBox[{"Riffle", "[", 
            RowBox[{
             RowBox[{"Head", "/@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"GetTOC", "[", 
                  RowBox[{"[", 
                   RowBox[{"#", "/.", 
                    RowBox[{"List", "->", "Sequence"}]}], "]"}], "]"}], "&"}],
                 "/@", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"NestList", "[", 
                  RowBox[{"Most", ",", "#", ",", 
                   RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "-", "1"}]}], 
                  "]"}]}]}], ")"}]}], ",", "\"\</\>\""}], "]"}]}], ")"}], 
         "&"}], "/@", "allinfo"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ShowStatus", "[", "\"\<Extracting data... (1/3)\>\"", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"base", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"TeXFix", "[", 
          RowBox[{"ImportString", "[", 
           RowBox[{
            RowBox[{"ExportString", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"n", "=", "0"}], ";", 
               RowBox[{"FixRefs", "[", 
                RowBox[{"Replace", "[", 
                 RowBox[{
                  RowBox[{"NotebookRead", "[", "#", "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"StyleBox", "[", 
                    RowBox[{"C_String", ",", 
                    RowBox[{"Background", "\[Rule]", 
                    InterpretationBox[
                    ButtonBox[
                    TooltipBox[
                    GraphicsBox[{
                    {GrayLevel[0], RectangleBox[{0, 0}]}, 
                    {GrayLevel[0], RectangleBox[{1, -1}]}, 
                    {RGBColor[0.88, 1, 0.88], RectangleBox[{0, -1}, {2, 1}]}},
                    
                    AspectRatio->1,
                    DefaultBaseStyle->"ColorSwatchGraphics",
                    Frame->True,
                    
                    FrameStyle->RGBColor[
                    0.5866666666666667, 0.6666666666666666, 
                    0.5866666666666667],
                    FrameTicks->None,
                    
                    ImageSize->
                    Dynamic[{Automatic, 
                    1.35 (CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
                    Magnification])}],
                    PlotRangePadding->None],
                    StyleBox[
                    RowBox[{"RGBColor", "[", 
                    RowBox[{"0.88`", ",", "1", ",", "0.88`"}], "]"}], 
                    NumberMarks -> False]],
                    Appearance->None,
                    BaseStyle->{},
                    BaselinePosition->Baseline,
                    ButtonFunction:>With[{Typeset`box$ = EvaluationBox[]}, 
                    If[
                    Not[
                    AbsoluteCurrentValue["Deployed"]], 
                    SelectionMove[Typeset`box$, All, Expression]; 
                    FrontEnd`Private`$ColorSelectorInitialAlpha = 1; 
                    FrontEnd`Private`$ColorSelectorInitialColor = 
                    RGBColor[0.88, 1, 0.88]; 
                    FrontEnd`Private`$ColorSelectorUseMakeBoxes = True; 
                    MathLink`CallFrontEnd[
                    FrontEnd`AttachCell[Typeset`box$, 
                    FrontEndResource["RGBColorValueSelector"], {
                    0, {Left, Bottom}}, {Left, Top}, 
                    "ClosingActions" -> {
                    "SelectionDeparture", "ParentChanged", 
                    "EvaluatorQuit"}]]]],
                    DefaultBaseStyle->{},
                    Evaluator->Automatic,
                    Method->"Preemptive"],
                    RGBColor[0.88, 1, 0.88],
                    Editable->False,
                    Selectable->False]}]}], "]"}], "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"n", "+=", "1"}], ";", 
                    RowBox[{"Anki", "[", 
                    RowBox[{"n", ",", "C"}], "]"}]}], ")"}]}], ",", 
                    RowBox[{
                    RowBox[{"StyleBox", "[", 
                    RowBox[{"C___", ",", 
                    RowBox[{"Background", "\[Rule]", 
                    InterpretationBox[
                    ButtonBox[
                    TooltipBox[
                    GraphicsBox[{
                    {GrayLevel[0], RectangleBox[{0, 0}]}, 
                    {GrayLevel[0], RectangleBox[{1, -1}]}, 
                    {RGBColor[0.88, 1, 0.88], RectangleBox[{0, -1}, {2, 1}]}},
                    
                    AspectRatio->1,
                    DefaultBaseStyle->"ColorSwatchGraphics",
                    Frame->True,
                    
                    FrameStyle->RGBColor[
                    0.5866666666666667, 0.6666666666666666, 
                    0.5866666666666667],
                    FrameTicks->None,
                    
                    ImageSize->
                    Dynamic[{Automatic, 
                    1.35 (CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
                    Magnification])}],
                    PlotRangePadding->None],
                    StyleBox[
                    RowBox[{"RGBColor", "[", 
                    RowBox[{"0.88`", ",", "1", ",", "0.88`"}], "]"}], 
                    NumberMarks -> False]],
                    Appearance->None,
                    BaseStyle->{},
                    BaselinePosition->Baseline,
                    ButtonFunction:>With[{Typeset`box$ = EvaluationBox[]}, 
                    If[
                    Not[
                    AbsoluteCurrentValue["Deployed"]], 
                    SelectionMove[Typeset`box$, All, Expression]; 
                    FrontEnd`Private`$ColorSelectorInitialAlpha = 1; 
                    FrontEnd`Private`$ColorSelectorInitialColor = 
                    RGBColor[0.88, 1, 0.88]; 
                    FrontEnd`Private`$ColorSelectorUseMakeBoxes = True; 
                    MathLink`CallFrontEnd[
                    FrontEnd`AttachCell[Typeset`box$, 
                    FrontEndResource["RGBColorValueSelector"], {
                    0, {Left, Bottom}}, {Left, Top}, 
                    "ClosingActions" -> {
                    "SelectionDeparture", "ParentChanged", 
                    "EvaluatorQuit"}]]]],
                    DefaultBaseStyle->{},
                    Evaluator->Automatic,
                    Method->"Preemptive"],
                    RGBColor[0.88, 1, 0.88],
                    Editable->False,
                    Selectable->False]}], ",", "D___"}], "]"}], 
                    "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"n", "+=", "1"}], ";", 
                    RowBox[{"Anki", "[", 
                    RowBox[{"n", ",", 
                    RowBox[{"StyleBox", "[", 
                    RowBox[{"C", ",", "D"}], "]"}]}], "]"}]}], ")"}]}], ",", 
                    " ", 
                    RowBox[{
                    RowBox[{"Cell", "[", 
                    RowBox[{"C___", ",", 
                    RowBox[{"Background", "\[Rule]", 
                    InterpretationBox[
                    ButtonBox[
                    TooltipBox[
                    GraphicsBox[{
                    {GrayLevel[0], RectangleBox[{0, 0}]}, 
                    {GrayLevel[0], RectangleBox[{1, -1}]}, 
                    {RGBColor[0.88, 1, 0.88], RectangleBox[{0, -1}, {2, 1}]}},
                    
                    AspectRatio->1,
                    DefaultBaseStyle->"ColorSwatchGraphics",
                    Frame->True,
                    
                    FrameStyle->RGBColor[
                    0.5866666666666667, 0.6666666666666666, 
                    0.5866666666666667],
                    FrameTicks->None,
                    
                    ImageSize->
                    Dynamic[{Automatic, 
                    1.35 (CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
                    Magnification])}],
                    PlotRangePadding->None],
                    StyleBox[
                    RowBox[{"RGBColor", "[", 
                    RowBox[{"0.88`", ",", "1", ",", "0.88`"}], "]"}], 
                    NumberMarks -> False]],
                    Appearance->None,
                    BaseStyle->{},
                    BaselinePosition->Baseline,
                    ButtonFunction:>With[{Typeset`box$ = EvaluationBox[]}, 
                    If[
                    Not[
                    AbsoluteCurrentValue["Deployed"]], 
                    SelectionMove[Typeset`box$, All, Expression]; 
                    FrontEnd`Private`$ColorSelectorInitialAlpha = 1; 
                    FrontEnd`Private`$ColorSelectorInitialColor = 
                    RGBColor[0.88, 1, 0.88]; 
                    FrontEnd`Private`$ColorSelectorUseMakeBoxes = True; 
                    MathLink`CallFrontEnd[
                    FrontEnd`AttachCell[Typeset`box$, 
                    FrontEndResource["RGBColorValueSelector"], {
                    0, {Left, Bottom}}, {Left, Top}, 
                    "ClosingActions" -> {
                    "SelectionDeparture", "ParentChanged", 
                    "EvaluatorQuit"}]]]],
                    DefaultBaseStyle->{},
                    Evaluator->Automatic,
                    Method->"Preemptive"],
                    RGBColor[0.88, 1, 0.88],
                    Editable->False,
                    Selectable->False]}], ",", "D___"}], "]"}], 
                    "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"n", "+=", "1"}], ";", 
                    RowBox[{"Anki", "[", 
                    RowBox[{"n", ",", 
                    RowBox[{"Cell", "[", 
                    RowBox[{"C", ",", "D"}], "]"}]}], "]"}]}], ")"}]}]}], 
                   "}"}], ",", "Infinity"}], "]"}], "]"}]}], ",", 
              "\"\<TeXFragment\>\""}], "]"}], ",", "\[IndentingNewLine]", 
            "\"\<Text\>\""}], "]"}], "]"}], "&"}], "/@", "cells"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"PrintToConsole", "[", "base", "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dat", "=", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"n", "=", "1"}], "}"}], ",", 
           RowBox[{"ReplaceRepeated", "[", 
            RowBox[{"data", ",", "\[IndentingNewLine]", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"ButtonBox", "[", 
                 RowBox[{
                  RowBox[{"DynamicBox", "[", 
                   RowBox[{"C_", ",", "___"}], "]"}], ",", "___"}], "]"}], 
                "\[RuleDelayed]", " ", 
                RowBox[{"Evaluate", "@", "C"}]}], ",", "\[IndentingNewLine]", 
               
               RowBox[{
                RowBox[{"ButtonBox", "[", 
                 RowBox[{
                  RowBox[{"RowBox", "[", "C__", "]"}], ",", "___"}], "]"}], 
                "\[RuleDelayed]", " ", "C"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"CounterBox", "[", 
                 RowBox[{"\"\<FigureCaptionNumbered\>\"", ",", "N_"}], "]"}], 
                "\[RuleDelayed]", " ", 
                RowBox[{"(", 
                 RowBox[{"First", "@", 
                  RowBox[{"Cases", "[", 
                   RowBox[{"data", ",", 
                    RowBox[{
                    RowBox[{"Cell", "[", 
                    RowBox[{
                    RowBox[{"TextData", "[", "name__", "]"}], ",", "___", 
                    ",", "\"\<Figure\>\"", ",", "___", ",", 
                    RowBox[{"CellTags", "\[Rule]", "N"}], ",", "___"}], "]"}],
                     "\[RuleDelayed]", "name"}], ",", "Infinity"}], "]"}]}], 
                 ")"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"CounterBox", "[", 
                 RowBox[{"\"\<EquationNumbered\>\"", ",", "N_"}], "]"}], 
                "\[RuleDelayed]", " ", 
                RowBox[{"(", 
                 RowBox[{"\"\<\\(\>\"", "<>", 
                  RowBox[{"ToTex", "[", 
                   RowBox[{"First", "@", 
                    RowBox[{"Cases", "[", 
                    RowBox[{"data", ",", 
                    RowBox[{
                    RowBox[{"Cell", "[", 
                    RowBox[{"name_", ",", "___", ",", 
                    RowBox[{"CellTags", "\[Rule]", "N"}], ",", "___"}], "]"}],
                     "\[RuleDelayed]", "name"}], ",", "Infinity"}], "]"}]}], 
                   "]"}], "<>", "\"\<\\) \>\""}], ")"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"CounterBox", "[", "___", "]"}], "\[RuleDelayed]", 
                "\"\<\>\""}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"StyleBox", "[", 
                 RowBox[{"D__", ",", 
                  RowBox[{"Background", "\[Rule]", "None"}], ",", "E___"}], 
                 "]"}], "\[RuleDelayed]", 
                RowBox[{"StyleBox", "[", 
                 RowBox[{"D", ",", "E"}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"StyleBox", "[", "D_String", "]"}], "\[RuleDelayed]", 
                "D"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"RowBox", "[", 
                 RowBox[{"{", "C__String", "}"}], "]"}], "\[RuleDelayed]", 
                RowBox[{"StringJoin", "@", "C"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Cell", "[", 
                 RowBox[{
                  RowBox[{"TextData", "[", "data_", "]"}], ",", "style_", ",",
                   "___", ",", " ", 
                  RowBox[{"CellID", "\[Rule]", "Nr_Integer"}]}], "]"}], 
                "\[RuleDelayed]", " ", 
                RowBox[{"{", 
                 RowBox[{"Nr", " ", ",", "data", ",", "style"}], "}"}]}], ",",
                "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Cell", "[", 
                 RowBox[{
                  RowBox[{"BoxData", "[", "data_", "]"}], ",", "style_", ",", 
                  "___", ",", " ", 
                  RowBox[{"CellID", "\[Rule]", "Nr_Integer"}]}], "]"}], 
                "\[RuleDelayed]", " ", 
                RowBox[{"{", 
                 RowBox[{"Nr", " ", ",", "data", ",", "style"}], "}"}]}], ",",
                "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Cell", "[", 
                 RowBox[{"data_", ",", "style_", ",", "___", ",", " ", 
                  RowBox[{"CellID", "\[Rule]", "Nr_Integer"}]}], "]"}], 
                "\[RuleDelayed]", " ", 
                RowBox[{"{", 
                 RowBox[{"Nr", " ", ",", "data", ",", "style"}], "}"}]}], ",",
                "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Cell", "[", 
                 RowBox[{
                  RowBox[{"BoxData", "[", "data_", "]"}], ",", "___"}], "]"}],
                 "\[RuleDelayed]", " ", "data"}]}], "\[IndentingNewLine]", 
              "}"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ShowStatus", "[", "\"\<Extracting data... (2/3)\>\"", "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"PrintToConsole", "[", 
         RowBox[{
         "\"\<Identified Ank collection folder \>\"", "<>", "tempPicPath"}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"dat", "=", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"pic", "=", "0"}], "}"}], ",", 
           RowBox[{"ReplaceAll", "[", 
            RowBox[{"dat", ",", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"FormBox", "[", 
                  RowBox[{
                   RowBox[{"GraphicsBox", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"C__", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"FaceForm", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"RGBColor", "[", 
                    RowBox[{"0.88", ",", "1", ",", "0.88"}], "]"}], ",", 
                    RowBox[{"Opacity", "[", "0.6", "]"}]}], "}"}], "]"}], ",",
                     "R__RectangleBox"}], "}"}], ",", "D___"}], "}"}], ",", 
                    "E___"}], "]"}], ",", "__"}], "]"}], "|", 
                 RowBox[{"GraphicsBox", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"C__", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"FaceForm", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"RGBColor", "[", 
                    RowBox[{"0.88", ",", "1", ",", "0.88"}], "]"}], ",", 
                    RowBox[{"Opacity", "[", "0.6", "]"}]}], "}"}], "]"}], ",",
                     "R__RectangleBox"}], "}"}], ",", "D___"}], "}"}], ",", 
                   "E___"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"\"\<{{c1::<img src=\\\"\>\"", "<>", 
                 RowBox[{"FileNameTake", "@", 
                  RowBox[{"Export", "[", 
                   RowBox[{
                    RowBox[{"tempPicPath", "<>", "\"\<f\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"++", "pic"}], "]"}], "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"Hash", "[", 
                    RowBox[{"Graphics", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"C", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"FaceForm", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"RGBColor", "[", 
                    RowBox[{"0.88", ",", "1", ",", "0.88"}], "]"}], ",", 
                    RowBox[{"Opacity", "[", "1.0", "]"}]}], "}"}], "]"}], ",",
                     "R"}], "}"}], ",", "D"}], "}"}], ",", "E"}], "]"}], 
                    "]"}], "]"}], "<>", "\"\<a.png\>\""}], ",", 
                    RowBox[{"Cell", "[", 
                    RowBox[{"BoxData", "[", 
                    RowBox[{"GraphicsBox", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"C", ",", "D"}], "}"}], ",", "E"}], "]"}], "]"}], 
                    "]"}]}], "]"}]}], "<>", "\"\<\\\">::<img src=\\\"\>\"", "<>", 
                 RowBox[{"FileNameTake", "@", 
                  RowBox[{"Export", "[", 
                   RowBox[{
                    RowBox[{"tempPicPath", "<>", "\"\<f\>\"", "<>", 
                    RowBox[{"ToString", "[", "pic", "]"}], "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"Hash", "[", 
                    RowBox[{"Graphics", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"C", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"FaceForm", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"RGBColor", "[", 
                    RowBox[{"0.88", ",", "1", ",", "0.88"}], "]"}], ",", 
                    RowBox[{"Opacity", "[", "1.0", "]"}]}], "}"}], "]"}], ",",
                     "R"}], "}"}], ",", "D"}], "}"}], ",", "E"}], "]"}], 
                    "]"}], "]"}], "<>", "\"\<.png\>\""}], ",", 
                    RowBox[{"Cell", "[", 
                    RowBox[{"BoxData", "[", 
                    RowBox[{"GraphicsBox", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"C", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"FaceForm", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"RGBColor", "[", 
                    RowBox[{"0.88", ",", "1", ",", "0.88"}], "]"}], ",", 
                    RowBox[{"Opacity", "[", "1.0", "]"}]}], "}"}], "]"}], ",",
                     "R"}], "}"}], ",", "D"}], "}"}], ",", "E"}], "]"}], 
                    "]"}], "]"}]}], "]"}]}], "<>", "\"\<\\\">}}\>\""}]}], ",",
                "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"FormBox", "[", 
                 RowBox[{
                  RowBox[{"FormBox", "[", "C__", "]"}], ",", "___"}], "]"}], 
                "\[RuleDelayed]", " ", "C"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"FormBox", "[", 
                   RowBox[{"C__", ",", " ", "TraditionalForm"}], "]"}], "|", 
                  RowBox[{"FormBox", "[", 
                   RowBox[{"C__", ",", " ", "TextForm"}], "]"}]}], ")"}], 
                "\[RuleDelayed]", 
                RowBox[{"(", 
                 RowBox[{"\"\<\\(\>\"", "<>", 
                  RowBox[{"ToTex", "[", "C", "]"}], "<>", "\"\<\\) \>\""}], 
                 ")"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"FormBox", "[", 
                 RowBox[{
                  RowBox[{"GraphicsBox", "[", "___", "]"}], ",", "___"}], 
                 "]"}], "\[RuleDelayed]", " ", "\"\<\>\""}], ",", 
               RowBox[{
                RowBox[{"GraphicsBox", "[", "___", "]"}], "\[RuleDelayed]", 
                " ", "\"\<\>\""}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"FormBox", "[", 
                 RowBox[{
                  RowBox[{"RowBox", "[", 
                   RowBox[{"{", 
                    RowBox[{"E___", ",", "TraditionalForm"}], "}"}], "]"}], 
                  ",", "___"}], "]"}], "\[RuleDelayed]", " ", 
                RowBox[{"FormBox", "[", 
                 RowBox[{
                  RowBox[{"RowBox", "[", 
                   RowBox[{"{", "E", "}"}], "]"}], ",", "TraditionalForm"}], 
                 "]"}]}]}], "\[IndentingNewLine]", "}"}]}], "]"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"ShowStatus", "[", "\"\<Extracting data... (3/3)\>\"", "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"dat", "=", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"n", "=", "1"}], "}"}], ",", 
           RowBox[{"ReplaceAll", "[", 
            RowBox[{"dat", ",", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"FormBox", "[", 
                   RowBox[{
                    RowBox[{"RowBox", "[", 
                    RowBox[{"{", "C__String", "}"}], "]"}], ",", "TextForm"}],
                    "]"}], "|", 
                  RowBox[{"FormBox", "[", 
                   RowBox[{
                    RowBox[{"RowBox", "[", 
                    RowBox[{"{", "C__String", "}"}], "]"}], ",", 
                    "TraditionalForm"}], "]"}]}], ")"}], "\[RuleDelayed]", 
                RowBox[{"StringJoin", "@", "C"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"FormBox", "[", 
                   RowBox[{"C__", ",", " ", "TraditionalForm"}], "]"}], "|", 
                  RowBox[{"FormBox", "[", 
                   RowBox[{"C__", ",", " ", "TextForm"}], "]"}]}], ")"}], 
                "\[RuleDelayed]", 
                RowBox[{"(", 
                 RowBox[{"\"\<\\(\>\"", "<>", 
                  RowBox[{"ToTex", "[", "C", "]"}], "<>", "\"\<\\) \>\""}], 
                 ")"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"StyleBox", "[", 
                 RowBox[{"D_", ",", "E___", " ", ",", 
                  RowBox[{"Background", "\[Rule]", "LightGreen"}], ",", 
                  "F___"}], "]"}], "\[RuleDelayed]", 
                RowBox[{"(", 
                 RowBox[{"\"\<{{c\>\"", "<>", 
                  RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<::\>\"", "<>",
                   "\[IndentingNewLine]", 
                  RowBox[{"ReplaceAll", "[", 
                   RowBox[{
                    RowBox[{"StyleBox", "[", 
                    RowBox[{"D", ",", "E", ",", "F"}], "]"}], ",", 
                    RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"StyleBox", "[", 
                    RowBox[{"U_String", ",", "___", ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}], ",", 
                    "___"}], "]"}], "\[RuleDelayed]", " ", 
                    RowBox[{"(", 
                    RowBox[{"\"\<<b>\>\"", "<>", "U", "<>", "\"\<</b>\>\""}], 
                    ")"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"StyleBox", "[", 
                    RowBox[{"U_String", ",", "___", ",", 
                    RowBox[{"FontSlant", "\[Rule]", "\"\<Italic\>\""}], ",", 
                    "___"}], "]"}], "\[RuleDelayed]", " ", 
                    RowBox[{"(", 
                    RowBox[{"\"\<<i>\>\"", "<>", "U", "<>", "\"\<</i>\>\""}], 
                    ")"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"StyleBox", "[", 
                    RowBox[{"U_String", ",", "___", ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Plain\>\""}], ",", 
                    "___"}], "]"}], "\[RuleDelayed]", " ", "U"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"StyleBox", "[", 
                    RowBox[{"U_String", ",", "___", ",", 
                    RowBox[{"FontVariations", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"___", ",", 
                    RowBox[{"\"\<Underline\>\"", "\[Rule]", "True"}], ",", 
                    "___"}], "}"}]}], ",", "___"}], "]"}], "\[RuleDelayed]", 
                    " ", 
                    RowBox[{"(", 
                    RowBox[{"\"\<<u>\>\"", "<>", "U", "<>", "\"\<</u>\>\""}], 
                    ")"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"StyleBox", "[", 
                    RowBox[{"U_String", ",", "___", ",", 
                    RowBox[{"FontVariations", "\[Rule]", "__"}], ",", "___"}],
                     "]"}], "\[RuleDelayed]", " ", "U"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"StyleBox", "[", 
                    RowBox[{"U_String", ",", "___"}], "]"}], "\[RuleDelayed]",
                     "U"}]}], "\[IndentingNewLine]", "}"}]}], "]"}], "<>", 
                  "\"\<}}\>\""}], ")"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"StyleBox", "[", 
                 RowBox[{"D_String", ",", "___", ",", 
                  RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}], ",", 
                  "___"}], "]"}], "\[RuleDelayed]", " ", 
                RowBox[{"(", 
                 RowBox[{"\"\<<b>\>\"", "<>", "D", "<>", "\"\<</b>\>\""}], 
                 ")"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"StyleBox", "[", 
                 RowBox[{"D_String", ",", "___", ",", 
                  RowBox[{"FontSlant", "\[Rule]", "\"\<Italic\>\""}], ",", 
                  "___"}], "]"}], "\[RuleDelayed]", " ", 
                RowBox[{"(", 
                 RowBox[{"\"\<<i>\>\"", "<>", "D", "<>", "\"\<</i>\>\""}], 
                 ")"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"StyleBox", "[", 
                 RowBox[{"D_String", ",", "___", ",", 
                  RowBox[{"FontWeight", "\[Rule]", "\"\<Plain\>\""}], ",", 
                  "___"}], "]"}], "\[RuleDelayed]", " ", "D"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"StyleBox", "[", 
                 RowBox[{"D_String", ",", "___", ",", 
                  RowBox[{"FontVariations", "\[Rule]", 
                   RowBox[{"{", 
                    RowBox[{"___", ",", 
                    RowBox[{"\"\<Underline\>\"", "\[Rule]", "True"}], ",", 
                    "___"}], "}"}]}], ",", "___"}], "]"}], "\[RuleDelayed]", 
                " ", 
                RowBox[{"(", 
                 RowBox[{"\"\<<u>\>\"", "<>", "D", "<>", "\"\<</u>\>\""}], 
                 ")"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"StyleBox", "[", 
                 RowBox[{"D_String", ",", "___", ",", 
                  RowBox[{"FontVariations", "\[Rule]", "__"}], ",", "___"}], 
                 "]"}], "\[RuleDelayed]", " ", "D"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"StyleBox", "[", 
                 RowBox[{"D_", ",", " ", 
                  RowBox[{"Background", "\[Rule]", "_"}]}], "]"}], 
                "\[RuleDelayed]", 
                RowBox[{"ToString", "[", "n", "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"RowBox", "[", 
                 RowBox[{"{", "C___String", "}"}], "]"}], "\[RuleDelayed]", 
                RowBox[{"StringJoin", "@", "C"}]}]}], "\[IndentingNewLine]", 
              "}"}]}], "]"}]}], "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"ShowStatus", "[", "\"\<Fixing data... (1/2)\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ids", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"CurrentValue", "[", 
          RowBox[{"#", ",", "\"\<CellID\>\""}], "]"}], "&"}], "/@", " ", 
        "cells"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"base", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"StringReplace", "[", 
             RowBox[{
              RowBox[{"StringJoin", "[", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"\"\<\\n\>\"", "\[Rule]", " ", "\"\<<br>\>\""}], ",", 
                
                RowBox[{
                "\"\<\[LineSeparator]\>\"", "\[Rule]", " ", 
                 "\"\<<br>\>\""}]}], "}"}]}], "]"}], ")"}], "&"}], "/@", " ", 
          "dat"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"styleTags", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"\"\< \>\"", "<>", 
             RowBox[{"#", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "<>", "\"\<::\>\"", "<>", " ", 
             RowBox[{"StringReplace", "[", 
              RowBox[{"title", ",", 
               RowBox[{"\"\< \>\"", "\[Rule]", " ", "\"\<\>\""}]}], "]"}]}], 
            ")"}], "&"}], "/@", "dat"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"ShowStatus", "[", "\"\<Fixing data... (2/2)\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"base", "=", 
       RowBox[{"StringReplace", "[", 
        RowBox[{"base", ",", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
             "\"\<}}\\\\color[HTML]{000000}\\\\color[HTML]{1111FF}{{c\>\"", "~~", 
              RowBox[{"Shortest", "[", "c__", "]"}], "~~", "\"\<::\>\""}], 
             ")"}], "\[Rule]", "\"\<\>\""}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\"\<}}{{c\>\"", "~~", 
             RowBox[{"Shortest", "[", "c__", "]"}], "~~", "\"\<::\>\""}], 
            "\[Rule]", "\"\<\>\""}], ",", "\[IndentingNewLine]", 
           RowBox[{"\"\<\\(\\)\>\"", "\[Rule]", "\"\<\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<{{c1::}}\>\"", "\[Rule]", "\"\<\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<\\n\>\"", "\[Rule]", "\"\<<br>\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<\\n\>\"", "\[Rule]", "\"\<<br>\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<{{c1::<br>}}\>\"", "\[Rule]", "\"\<<br>\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\"\<^{\>\"", "~~", 
               RowBox[{"Shortest", "[", "c__", "]"}], "~~", "\"\<}^{\>\"", "~~", 
               RowBox[{"WhitespaceCharacter", "..."}], "~~", 
               "\"\<\\\\dagger\>\"", "~~", 
               RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<}\>\""}], 
              ")"}], "/;", 
             RowBox[{"StringFreeQ", "[", 
              RowBox[{"c", ",", 
               RowBox[{"\"\<}\>\"", "|", "\"\<{\>\""}]}], "]"}]}], 
            "\[RuleDelayed]", 
            RowBox[{"\"\<^{\>\"", "<>", "c", "<>", "\"\<\\\\dagger}\>\""}]}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\"\<^\>\"", "~~", "c_", "~~", "\"\<^{\>\"", "~~", 
               RowBox[{"WhitespaceCharacter", "..."}], "~~", 
               "\"\<\\\\dagger\>\"", "~~", 
               RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<}\>\""}], 
              ")"}], "/;", 
             RowBox[{"StringFreeQ", "[", 
              RowBox[{"c", ",", 
               RowBox[{"\"\<}\>\"", "|", "\"\<{\>\""}]}], "]"}]}], 
            "\[RuleDelayed]", 
            RowBox[{"\"\<^{\>\"", "<>", "c", "<>", "\"\<\\\\dagger}\>\""}]}], 
           ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\"\<^{\>\"", "~~", 
               RowBox[{"Shortest", "[", "c__", "]"}], "~~", 
               "\"\<}^{\\\\mathsf{T}\>\"", "~~", 
               RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<}\>\""}], 
              ")"}], "/;", 
             RowBox[{"StringFreeQ", "[", 
              RowBox[{"c", ",", 
               RowBox[{"\"\<}\>\"", "|", "\"\<{\>\""}]}], "]"}]}], 
            "\[RuleDelayed]", 
            RowBox[{
            "\"\<^{\>\"", "<>", "c", "<>", "\"\<\\\\mathsf{T}}\>\""}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\"\<^\>\"", "~~", "c_", "~~", "\"\<^{\>\"", "~~", 
               RowBox[{"WhitespaceCharacter", "..."}], "~~", 
               "\"\<\\\\mathsf{T}\>\"", "~~", 
               RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<}\>\""}], 
              ")"}], "/;", 
             RowBox[{"StringFreeQ", "[", 
              RowBox[{"c", ",", 
               RowBox[{"\"\<}\>\"", "|", "\"\<{\>\""}]}], "]"}]}], 
            "\[RuleDelayed]", 
            RowBox[{
            "\"\<^{\>\"", "<>", "c", "<>", "\"\<\\\\mathsf{T}}\>\""}]}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\"\<^{\>\"", "~~", 
               RowBox[{"Shortest", "[", "c__", "]"}], "~~", "\"\<}^{\>\"", "~~", 
               RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<*\>\"", "~~", 
               RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<}\>\""}], 
              ")"}], "/;", 
             RowBox[{"StringFreeQ", "[", 
              RowBox[{"c", ",", 
               RowBox[{"\"\<}\>\"", "|", "\"\<{\>\""}]}], "]"}]}], 
            "\[RuleDelayed]", 
            RowBox[{"\"\<^{\>\"", "<>", "c", "<>", "\"\<*}\>\""}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"\"\<^\>\"", "~~", "c_", "~~", "\"\<^{\>\"", "~~", 
               RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<*\>\"", "~~", 
               RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<}\>\""}], 
              ")"}], "/;", 
             RowBox[{"StringFreeQ", "[", 
              RowBox[{"c", ",", 
               RowBox[{"\"\<}\>\"", "|", "\"\<{\>\""}]}], "]"}]}], 
            "\[RuleDelayed]", 
            RowBox[{"\"\<^{\>\"", "<>", "c", "<>", "\"\<*}\>\""}]}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\"\<\\\\overset{\>\"", "~~", 
             RowBox[{"WhitespaceCharacter", "..."}], "~~", 
             "\"\<\\\\mathsym{\>\"", "~~", 
             RowBox[{"WhitespaceCharacter", "..."}], "~~", 
             "\"\<\\\\OverBracket\>\"", "~~", 
             RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<}\>\"", "~~", 
             
             RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<}\>\""}], 
            "\[RuleDelayed]", " ", "\"\<\\\\overbrace\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\"\<\\\\underset{\>\"", "~~", 
             RowBox[{"WhitespaceCharacter", "..."}], "~~", 
             "\"\<\\\\mathsym{\>\"", "~~", 
             RowBox[{"WhitespaceCharacter", "..."}], "~~", 
             "\"\<\\\\UnderBracket\>\"", "~~", 
             RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<}\>\"", "~~", 
             
             RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<}\>\""}], 
            "\[RuleDelayed]", " ", "\"\<\\\\underbrace\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\"\<\\\\text{\>\"", "~~", 
                RowBox[{"Shortest", "[", "c__", "]"}], "~~", "\"\<}\>\""}], 
               ")"}], "\[RuleDelayed]", 
              RowBox[{"ToString", "@", 
               RowBox[{"StringReplace", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", 
                  RowBox[{"\"\<$\>\"", "\[RuleDelayed]", "  ", "\"\<\>\""}], 
                  "}"}]}], "]"}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\"\<\\\\left\\\\left|\>\"", "~~", 
             RowBox[{"Shortest", "[", "c__", "]"}], "~~", 
             "\"\<\\\\right\\\\right|\>\""}], "\[RuleDelayed]", " ", 
            RowBox[{
            "\"\<\\\\left|\>\"", "~~", "c", " ", "~~", 
             "\"\<\\\\right|\>\""}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\"\<\\\\right\\\\right| \>\"", "~~", 
             RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<{}_\>\""}], 
            "\[RuleDelayed]", " ", "\"\<\\\\right|_\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\"\<\\\\right\\\\right| \>\"", "~~", 
             RowBox[{"WhitespaceCharacter", "..."}], "~~", "\"\<_\>\""}], 
            "\[RuleDelayed]", " ", "\"\<\\\\right|_\>\""}]}], 
          "\[IndentingNewLine]", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
      "ShowStatus", "[", "\"\<Exporting to Wolfram Cloud...\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ndir", "=", 
       RowBox[{"NotebookDirectory", "[", 
        RowBox[{"EvaluationNotebook", "[", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"npath", "=", 
       RowBox[{"NotebookFileName", "[", 
        RowBox[{"EvaluationNotebook", "[", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"cloudex", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"backupc", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"CurrentValue", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"{", "\"\<CellTags\>\"", "}"}]}], "]"}], "}"}], 
              "]"}], ")"}], "&"}], "/@", 
           RowBox[{"Cells", "[", 
            RowBox[{
             RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
             RowBox[{"CellID", "\[Rule]", "ids"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"SetOptions", "[", 
             RowBox[{"#1", ",", 
              RowBox[{"CellTags", "\[Rule]", 
               RowBox[{"Append", "[", 
                RowBox[{"#2", ",", 
                 RowBox[{"ToString", "@", 
                  RowBox[{"CurrentValue", "[", 
                   RowBox[{"#", ",", "\"\<CellID\>\""}], "]"}]}]}], "]"}]}]}],
              "]"}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Cells", "[", 
              RowBox[{
               RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
               RowBox[{"CellID", "\[Rule]", "ids"}]}], "]"}], ",", 
             "backupc"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"FrontEndExecute", "[", 
          RowBox[{"FrontEndToken", "[", 
           RowBox[{
            RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
            "\"\<SelectAll\>\""}], "]"}], "]"}], ";", "\n", "\t", 
         RowBox[{"FrontEndTokenExecute", "[", 
          RowBox[{
           RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
           "\"\<SelectionCloseAllGroups\>\""}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"filtered", "=", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"ids", ",", "base", ",", "paths", ",", 
               RowBox[{"ExportToCloud", "[", "]"}], ",", "celltags"}], "}"}], 
             "]"}], ",", 
            RowBox[{
             RowBox[{"StringMatchQ", "[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<*{{c@::*\>\""}], 
              "]"}], " ", "&"}]}], " ", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"FrontEndExecute", "[", 
          RowBox[{"FrontEndToken", "[", 
           RowBox[{
            RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
            "\"\<SelectAll\>\""}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"FrontEndTokenExecute", "[", 
          RowBox[{
           RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
           "\"\<SelectionOpenAllGroups\>\""}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"SetOptions", "[", 
             RowBox[{"#1", ",", 
              RowBox[{"CellTags", "\[Rule]", "#2"}]}], "]"}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Cells", "[", 
              RowBox[{
               RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
               RowBox[{"CellID", "\[Rule]", "ids"}]}], "]"}], ",", 
             "backupc"}], "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", ",", 
        RowBox[{
         RowBox[{"filtered", "=", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{
              "ids", ",", "base", ",", "paths", ",", "npath", ",", 
               "celltags"}], "}"}], "]"}], ",", 
            RowBox[{
             RowBox[{"StringMatchQ", "[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<*{{c@::*\>\""}], 
              "]"}], "&"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ShowStatus", "[", "\"\<Exporting to Anki...\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"deck", "=", 
       RowBox[{"StringReplace", "[", 
        RowBox[{
         RowBox[{"StringReplace", "[", 
          RowBox[{"ndir", ",", 
           RowBox[{
            RowBox[{
            "e___", "~~", "\"\</Knowledge/\>\"", " ", "~~", " ", "f___", " ", 
             "~~", "\"\</\>\""}], "\[RuleDelayed]", " ", "f"}]}], "]"}], ",", 
         
         RowBox[{"\"\</\>\"", ":>", "\"\<::\>\""}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintToConsole", "[", "deck", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintToConsole", "[", 
       RowBox[{"AnkiRequest", "[", 
        RowBox[{"\"\<createDeck\>\"", ",", 
         RowBox[{"<|", 
          RowBox[{"\"\<deck\>\"", "\[Rule]", "deck"}], "|>"}]}], "]"}], "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"AddOrUpdateNotes", "[", 
       RowBox[{"deck", ",", "filtered"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"sync", ",", 
        RowBox[{"PrintToConsole", "[", 
         RowBox[{"AnkiRequest", "[", "\"\<sync\>\"", "]"}], "]"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ShowStatus", "[", "\"\<Notebook Exported\>\"", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"d51dd649-91e4-4df7-ac14-bec28aeb64c3"]
},
AutoGeneratedPackage->Automatic,
WindowSize->{960, 855},
WindowMargins->{{16, Automatic}, {Automatic, -1086}},
FrontEndVersion->"12.0 for Mac OS X x86 (64-bit) (April 8, 2019)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"], CellID -> 738859862]}, 
  Visible -> False, FrontEndVersion -> 
  "12.0 for Mac OS X x86 (64-bit) (April 8, 2019)", StyleDefinitions -> 
  "PrivateStylesheetFormatting.nb"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 102815, 2344, 8161, "Input",ExpressionUUID->"d51dd649-91e4-4df7-ac14-bec28aeb64c3",
 InitializationCell->True]
}
]
*)

